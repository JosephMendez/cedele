"use strict";(function(){jQuery(document).ready(function(x){function t(){return x(".wc-lpp-help-tip").each(function(){return x(this).tipTip({content:x(this).data("tip"),keepAlive:!0,edgeOffset:2})})}function a(e){return!!e&&(e.is(".processing")||e.parents(".processing").length)}function d(e){if(e&&!a(e))return e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function s(e){if(e)return e.removeClass("processing").unblock()}function n(){var i=x("form.woocommerce-cart-form"),n=x("#order_review");return x('input[name^="shipping_method"][type="radio"]').on("change",function(){var e,t,a;return d(i),d(n),t="local_pickup_plus"===x(this).val()?"pickup":"ship",a=x(this).attr("data-index"),e={action:"wc_local_pickup_plus_set_package_items_handling",security:D.set_package_items_handling_nonce,package_id:a,handling:t},x.post({url:D.ajax_url,data:e}).done(function(e){return e.success?D.is_cart?x(document).trigger("wc_update_cart"):D.is_checkout?(D.apply_pickup_location_tax&&x(document.body).on("updated_checkout",function(e){return d(n),location.reload()}),x(document.body).trigger("update_checkout")):void 0:console.log(e)}).always(function(){return s(i),s(n)})})}function i(e){var t,a;return e.id?(a=t="",e.name&&e.address?(a=e.name,t=e.address):x(e.element)&&(a=x(e.element).data("name"),t=x(e.element).data("address")),""!==a?x('<div id="wc-local-pickup-plus-pickup-location-option-'+e.id+'" class="wc-local-pickup-plus-pickup-location-option"><span class="wc-location-pickup-plus-pickup-location-option-name" style="display:block;">'+a+'</span><small class="wc-location-pickup-plus-pickup-location-option-address" style="display:inline-block;">'+t+"</small></div>"):e.text):e.text?e.text:""}function c(){var e;return x("a.enable-local-pickup, a.disable-local-pickup").on("click",function(e){var t,a,i,n,c,o,p,r,l,u;return e.preventDefault(),i=x(this).parent().parent(),t=x("form.woocommerce-cart-form"),a=x("#order_review"),x(this).hasClass("enable-local-pickup")?(r="pickup",i.find("a.enable-local-pickup").parent().hide(),i.find("a.disable-local-pickup").parent().show(),i.find("> div").show()):(r="ship",i.find("a.enable-local-pickup").parent().show(),i.find("a.disable-local-pickup").parent().hide(),i.find("> div").hide()),d(t),d(a),n=i.find(".pickup-location-lookup-area"),(l=(u=(o=i.find(".pickup-location-lookup")).attr("data-single-pickup-location"))&&0<parseInt(u,10)?u:o.val())||"per-order"!==D.pickup_selection_mode||(l=(c=x('[name="shipping_method_pickup_location_id[0]"]')).length?c.val():l),p={action:"wc_local_pickup_plus_set_cart_item_handling",security:D.set_cart_item_handling_nonce,cart_item_key:i.data("pickup-object-id"),pickup_data:{handling:r,lookup_area:n.val(),pickup_location_id:l}},x.post(D.ajax_url,p,function(e){return"per-order"===D.pickup_selection_mode&&x(".pickup-location-lookup").trigger("change"),s(t),s(a),e.success?D.is_cart?x(document).trigger("wc_update_cart"):D.is_checkout?x(document.body).trigger("update_checkout"):void 0:console.log(e)})}),x(".pickup-location-change-lookup-area").on("click",function(e){return e.preventDefault(),x(this).closest("div.pickup-location-lookup-area-field").find("> div").toggle()}),(e=x("select.pickup-location-lookup-area")).select2(),e.on("change",function(){var t,a,e,i,n,c,o,p,r,l,u=x(this).closest(".pickup-location-lookup-area-field").data("pickup-object-id");if(!x("#pickup-location-field-for-"+u).find("a.enable-local-pickup").is(":visible")&&(i=x("#pickup-location-lookup-area-field-for-"+u).find("em.pickup-location-current-lookup-area-label"),o=x(this).select2("data"),t=x("form.woocommerce-cart-form"),a=x("#order_review"),o&&o[0]&&o[0].text&&i.text(o[0].text),d(t),d(a),r=(n=x("#pickup-location-field-for-"+u).find(".pickup-location-lookup")).data("pickup-object-type"),p=(l=n.attr("data-single-pickup-location"))&&0<parseInt(l,10)?l:n.val(),"cart-item"===r?c={action:"wc_local_pickup_plus_set_cart_item_handling",security:D.set_cart_item_handling_nonce,cart_item_key:u,pickup_data:{handling:"pickup",lookup_area:x(this).val(),pickup_location_id:p}}:"package"===r&&(e=x("#wc-local-pickup-plus-datepicker-"+u),c={action:"wc_local_pickup_plus_set_package_handling",security:D.set_package_handling_nonce,package_id:u,lookup_area:x(this).val(),pickup_location_id:p},e.length&&e.val()&&(c.pickup_date=e.val())),c))return x.post(D.ajax_url,c,function(e){return s(t),s(a),e.success?D.is_cart?x(document).trigger("wc_update_cart"):D.is_checkout?x(document.body).trigger("update_checkout"):void 0:console.log(e)})})}function o(){function t(e,t,a){var i,n,c,o;return e=e?e.toLowerCase():"",t=t?t.toLowerCase():"",c=!1,e&&(t&&-1<t.indexOf(e)&&(c=!0),!c&&a&&(o=String(x(a.element).data("postcode")),n=x(a.element).data("city"),i=x(a.element).data("address"),o&&-1<o.toString().toLowerCase().indexOf(e)&&(c=!0),!c&&n&&-1<n.toString().toLowerCase().indexOf(e)&&(c=!0),!c&&i&&-1<i.toString().toLowerCase().indexOf(e)&&(c=!0))),c}var n=x("select.pickup-location-lookup");return D.use_enhanced_search?n.select2({initSelection:function(e,t){var a,i=e.val();return""!==i?(a={action:"wc_local_pickup_plus_get_pickup_location_name",security:D.get_pickup_location_name_nonce,id:i},x.post(D.ajax_url,a,function(e){if(e&&e.success&&e.data)return t({id:i,text:e.data})})):t({text:n.data("placeholder")})},minimumInputLength:2,language:{inputTooShort:function(){return D.i18n.search_type_minimum_characters},errorLoading:function(){return D.i18n.search_error_loading},loadingMore:function(){return D.i18n.search_loading_more},noResults:function(){return D.i18n.search_no_results},searching:function(){return D.i18n.search_searching}},templateResult:i,ajax:{url:D.ajax_url,cache:!1,dataType:"json",delay:250,data:function(e){var t=x(this).data("product-id"),a=x(this).data("pickup-object-id"),i=x(this).parent().find("#pickup-location-lookup-area-for-"+a);return{term:e.term,area:i?i.find("option:selected").val():"",cart_item_id:a,product_id:t,page:e.page,security:D.pickup_locations_lookup_nonce,action:"wc_local_pickup_plus_pickup_locations_lookup"}},processResults:function(e){var t=e&&e.success&&e.data?e.data:[];return{results:t}}}}):x.fn.select2.amd.require(["select2/compat/matcher"],function(e){return n.select2({templateResult:i,matcher:e(t)})}),n.on("change",function(e){var t,a,i,n,c,o=x("form.woocommerce-cart-form, div.cart_totals"),p=x("#order_review");if(d(o),d(p),n=x(this).data("pickup-object-type"),c=x(this).data("pickup-object-id"),a=x(this).val(),i=x("#pickup-location-lookup-area-for-"+c).val(),"cart-item"===n?t={action:"wc_local_pickup_plus_set_cart_item_handling",security:D.set_cart_item_handling_nonce,cart_item_key:c,pickup_data:{handling:"pickup",lookup_area:i,pickup_location_id:a}}:"package"===n&&(t={action:"wc_local_pickup_plus_set_package_handling",security:D.set_package_handling_nonce,package_id:c,lookup_area:i,pickup_location_id:a}),t)return x.post(D.ajax_url,t,function(e){return s(o),s(p),e.success?D.is_cart?x(document).trigger("wc_update_cart"):D.is_checkout?x(document.body).trigger("update_checkout"):void 0:console.log(e)})})}function p(){var e,t,a;if(!D.display_shipping_address_fields)return(a="per-item"===D.pickup_selection_mode?(t=parseInt(x("#wc-local-pickup-plus-packages-to-pickup").val(),10),parseInt(x("#wc-local-pickup-plus-packages-to-ship").val(),10)):(t=(e=x(".woocommerce-shipping-methods")).find("input[value=local_pickup_plus]:checked").length,e.find("input[type=radio]:checked").not("input[value=local_pickup_plus]").length))<t&&0===a?(x("#shiptobilling, #ship-to-different-address").hide(),x("#shiptobilling, #ship-to-different-address").parent().find("h3").hide(),x("#ship-to-different-address input").prop("checked",!1),x(".shipping_address").hide()):(x("#shiptobilling, #ship-to-different-address").show(),x("#shiptobilling, #ship-to-different-address").parent().find("h3").show(),x("#ship-to-different-address input").is(":checked")?x(".shipping_address").show():x(".shipping_address").hide())}function e(){return x(".woocommerce-shipping-totals").each(function(){if("local_pickup_plus"===x(this).find("input.shipping_method:checked").val()||"local_pickup_plus"===x(this).find("input:hidden.shipping_method").val())return x(this).find("p.woocommerce-shipping-destination").hide(),x(this).find(".woocommerce-shipping-calculator").hide()})}var r,D=null!=(r=window.wc_local_pickup_plus_frontend)?r:{};return t(),n(),c(),o(),"undefined"!=typeof wc_cart_params&&e(),"undefined"!=typeof wc_checkout_params&&p(),x(document.body).on("updated_checkout",function(){function i(a,e,t){var i,n,c,o,p,r,l,u,d,s,_=2<arguments.length&&void 0!==t&&t,k=a.find("input.pickup-location-appointment-date"),f=a.find("input.pickup-location-appointment-date-alt"),h=a.find("[id^=wc-local-pickup-plus-date-clear-]"),g=k.val(),m=k.data("location-id"),v=k.data("package-id"),w=""!==g?new Date(g):e.default_date&&""!==e.default_date?new Date(1e3*e.default_date):null,y=e.unavailable_dates?x.map(e.unavailable_dates,function(e){return e}):[];return _&&(k.attr("value",""),k.trigger("change"),k.removeClass("hasDatepicker"),k.datepicker("destroy")),r=new Date(1e3*e.calendar_start),p=new Date(1e3*e.calendar_end),r=new Date(r.getTime()+60*r.getTimezoneOffset()*1e3),p=new Date(p.getTime()+60*p.getTimezoneOffset()*1e3),w=new Date(w.getTime()+60*w.getTimezoneOffset()*1e3),k.datepicker({minDate:r,maxDate:p,altField:"#"+f.attr("id"),altFormat:"yy-mm-dd",dateFormat:D.date_format,defaultDate:w||null,firstDay:D.start_of_week,monthNames:D.month_names,dayNamesMin:D.day_initials,prevText:"",nextText:"",showOn:"both",buttonText:"&nbsp;",gotoCurrent:!0,beforeShow:function(e,t){return x(t.dpDiv).addClass("pickup-location-appointment-datepicker").addClass("pickup-location-appointment-datepicker-"+v)},beforeShowDay:function(e){var t=x.datepicker.formatDate("yy-mm-dd",e);return[-1===y.indexOf(t)]},onSelect:b}).one("init",function(e){return x("button.ui-datepicker-trigger").attr("title",D.i18n.datepicker_button)}).trigger("init"),i=null,o=l=s=0,k.on("keydown",function(e){var t,a;if(i&&null!==i&&0!==i.length||((t=(a=x(".pickup-location-appointment-datepicker-"+v).find(".ui-datepicker-calendar")).find(".ui-datepicker-current-day"))&&0!==t.length?i=t:(t=a.find("tbody tr td").not(".ui-datepicker-unselectable, .ui-state-disable").first(),(i=t)&&!i.hasClass("ui-datepicker-cursor")&&i.addClass("ui-datepicker-cursor"))),"ArrowLeft"===e.key?t=i.prevAll("td").not(".ui-datepicker-unselectable, .ui-state-disable").first():"ArrowRight"===e.key?t=i.nextAll("td").not(".ui-datepicker-unselectable, .ui-state-disable").first():"ArrowUp"===e.key?t=(t=i.parent("tr").prevAll("tr").first().find("td"))?t.not(".ui-datepicker-unselectable, .ui-state-disable").first():null:"ArrowDown"===e.key?t=(t=i.parent("tr").nextAll("tr").first().find("td"))?t.not(".ui-datepicker-unselectable, .ui-state-disable").first():null:"PageUp"===e.key||"PageDown"===e.key?(a=x(".pickup-location-appointment-datepicker-"+v).find(".ui-datepicker-calendar"),t="PageDown"===e.key?a?a.find("tbody tr td").not(".ui-datepicker-unselectable, .ui-state-disable").first():null:a?a.find("tbody tr td").not(".ui-datepicker-unselectable, .ui-state-disable").last():null):"Enter"===e.key&&0<s&&0<l&&0<o&&i.trigger("click"),t&&"selectDay"===t.data("handler")&&(e.preventDefault(),i.removeClass("ui-datepicker-cursor"),(i=t.first()).addClass("ui-datepicker-cursor"),s=parseInt(i.data("year"),10),l=parseInt(i.data("month"),10),o=parseInt(i.find("a").text(),10),0<s&&0<l&&0<o))return x("#wc-local-pickup-plus-datepicker-"+v+"-live-region").html(x.datepicker.formatDate(D.date_format,new Date(s,l,o)))}),(n=a.find("select.pickup-location-appointment-offset")).select2(),n.on("change",function(e){return e.preventDefault(),e.stopPropagation(),b(x.datepicker.formatDate("yy-mm-dd",k.datepicker("getDate")),k)}),(u=(c=k.val())&&""!==c?x.datepicker.parseDate("yy-mm-dd",c):null)?(k.datepicker("setDate",u),x("#ui-datepicker-div").hide()):e.auto_select_default&&e.default_date&&""!==e.default_date&&(d=x.datepicker.parseDate("yy-mm-dd",e.default_date))&&(k.datepicker("setDate",d),x("#ui-datepicker-div").hide(),b(d,k)),h.on("click",function(e){var t;return e.preventDefault(),k.datepicker("setDate",null),k.attr("value",""),t={action:"wc_local_pickup_plus_set_package_handling",security:D.set_package_handling_nonce,pickup_date:"",package_id:v,pickup_location_id:m},x.post(D.ajax_url,t,function(e){return e.success||console.log(e),a.find(".pickup-location-schedule").empty(),x(document.body).trigger("update_checkout")})})}var b=function(e,t){var a,i=t.input||t,n=i.parent().parent(),c=i.data("location-id"),o=i.data("package-id"),p=x("#wc-local-pickup-plus-pickup-date-"+o).val(),r=x("#wc-local-pickup-plus-pickup-appointment-offset-"+o),l=r.val();if(e&&p&&new Date(p))return i.attr("value",e),a={action:"wc_local_pickup_plus_set_package_handling",security:D.set_package_handling_nonce,pickup_date:p,package_id:o,pickup_location_id:c,appointment_offset:l},x.post(D.ajax_url,a,function(e){return e.success||console.log(e),0===r.length?(a={action:"wc_local_pickup_plus_get_pickup_location_opening_hours_list",security:D.get_pickup_location_opening_hours_list_nonce,location:c,date:p},x.post(D.ajax_url,a,function(e){var t=n.find(".pickup-location-schedule");if(t.empty(),e&&e.success)return t.append(e.data),x(document.body).trigger("update_checkout")})):x(document.body).trigger("update_checkout")})},e=x(".pickup-location-appointment");return e&&e.each(function(){var t=x(this),e=t.find("input.pickup-location-appointment-date").data("location-id"),a={action:"wc_local_pickup_plus_get_pickup_location_appointment_data",security:D.get_pickup_location_appointment_data_nonce,location:e};return x.post(D.ajax_url,a,function(e){if(e.success)return i(t,e.data)})}),t(),n(),c(),o(),p(),x("#order_review").find("> p.woocommerce-shipping-contents").remove()}),x("#order_review").find("> p.woocommerce-shipping-contents").remove(),x(document.body).on("updated_cart_totals",function(){return t(),n(),c(),o(),e()})})}).call(void 0);